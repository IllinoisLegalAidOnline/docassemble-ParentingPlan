metadata:
  title: Parenting plan
  short title: Parenting plan
  comment: This program helps you create a plan to set parental responsibilities (formerly custody) and parenting time (formerly visitation).
  authors:
    - Jim Graszer
    - Matt Newsted
---
include:
  - docassemble.AssemblyLine:assembly_line.yml
  - docassemble.ILAO:ilao-interview-framework.yml
  - docassemble.ILAO:shared-basic-questions.yml
  - parenting_plan_questions.yml
---
objects:
  - users: ALPeopleList.using(there_are_any=True)
  - other_parties: ALPeopleList.using(there_are_any=True)
  - employer: ALIndividual
  - other_employer: ALIndividual
  - children: ALPeopleList.using(there_are_any=True)
  - court_list: ALCourtLoader.using(file_name='docassemble.ILAO:data/sources/il_courts.xlsx')
---
code: |
  al_form_type = 'existing_case'
  ilao_easy_form_title = "Parenting Plan"
  ilao_easy_form_url = "https://www.illinoislegalaid.org/legal-information/parenting-plan"
  form_name = "Parenting Plan"
  github_user = 'IllinoisLegalAidOnline'
  github_repo_name = 'docassemble-ParentingPlan'
  allowed_courts = ['Circuit']
---
sections:
  - section_intro: Start
  - section_case: Case info
  - section_family: Family members
  - section_decisions: Decision making
  - section_schedule: Parenting time
  - section_terms: Other Parenting Plan terms
  - section_download: Download
---
#################### Interview order #####################
mandatory: True
code: |
  nav.set_section('section_intro')
  sees_nav_bar
  set_progress(5)
  how_to_use
  accept_terms
  about_screen
  if family_case == False:
    family_kickout
  
  nav.set_section('section_case')
  set_progress(15)
  plan_type
  case_county
  case_number

  nav.set_section('section_family')
  set_progress(15)
  users[0].name.first
  if hide_contact == False:
    users[0].address.address
  users[0].phone_number
  if has_employer:
    employer.name.first
  other_parties[0].name.first
  if has_other_address:
    other_parties[0].address.address
  other_parties[0].phone_number
  if has_other_employer:
    other_employer.name.first
  children.gather()

  nav.set_section('section_decisions')
  set_progress(40)
  eduction_decisions
  health_decisions
  religious_decisions
  activities_decisions
  first_refusal
  communication
  primary_parent
  residential_address
  mediation

  set_progress(60)
  nav.set_section('section_schedule')
  parenting_time

  set_progress(90)
  nav.set_section('section_terms')
  accept_rights


  set_progress(100)
  nav.set_section('section_download')
  forms_assembling
  get_docs_screen
---
id: welcome
continue button field: sees_nav_bar
question: |
  Parenting Plan
subquestion: |
  Welcome to Illinois Legal Aid Online's **${form_name}** Easy Form.

  This program helps you make forms that provide financial information and documents to the other party in family law cases.
  
  If you are in a court case for divorce, child support, or temporary maintenance, you and the other person will probably have to share information about your income, property, and expenses. 
---
id: how to use
continue button field: how_to_use
question: |
  Instructions
subquestion: |
  To complete this program, you will need to know:


  It could take 30 minutes to 60 minutes to finish this program. You can log in and save your work to return to later. 
 
  ${ collapse_template(help_example) }  

  Click on **{green words}** to learn what they mean. Some questions have a question mark in a circle ${ fa_icon("question-circle", color_css="#0dcaf0" ) } that also gives help.
---
template: help_example
subject: |
  **You can expand sections like this to show more information.**
content: |  
  This is an example of help. Click again to hide.
---
id: about 
continue button field: about_screen
question: |
  About the *Parenting Plan*
subquestion: |
  The *${form_name}* is a very long form.




  A Parenting Plan contains information about who will make decisions for the children and a schedule for when the children are with each parent.
  
  If you have completed the Parenting Plan by the time you are ready to file your case, you can file it with your petition (example: divorce, parental responsibilities, etc.).
  
  If not, you must file it within 120 days of the date you file your petition.
  
  Learn more about Parenting plans.
---
id: family case 
question: |
  Do you have a family law case in Illinois?
subquestion: |
  The case can be ongoing or one where a final Judgment or Order was entered.
fields:
  - no label: family_case
    datatype: yesnoradio
---
id: family case kickout
event: family_kickout
question: |
  Sorry
subquestion: |
  You can only use this program if you have a family law case in Illinois.

  Use **[Get Legal Help](https://www.illinoislegalaid.org/get-legal-help)** to find free or low-cost legal services in your area.
buttons:
  - Exit: exit
  - Restart: restart
---
########################## CASE INFO #######################
id: parenting plan type 
question: |
  Whose Parenting Plan is this?
fields:
  - Parenting plan: plan_type
    datatype: radio 
    choices: 
      - Yours: petitioner
      - The other parent's: respondent
      - An agreed Parenting Plan: both
      - Unsure: unsure
---
id: party label
question: |
  What is your role in the case?
subquestion: |
  ${ collapse_template(which_party) }  
field: party_label
choices:
  - Petitioner: petitioner
  - Plaintiff: plaintiff
  - Respondent: respondent
  - Defendant: defendant
---
template: which_party
subject: |
  **Learn more about party labels**
content: |
  If you filed a new case, you are either the Petitioner or the Plaintiff.

  If someone filed the case against you, you are either the Respondent or the Defendant.

  Most family law cases use Petitioner and Respondent.
  
  The other court papers in the case should help you figure it out. Look at the top (the caption)
  of the Petition, Complaint, or Order. That form should have a label by your name.
---
id: case county
question: |
  In which county was this case filed?
fields:
  - County: case_county
    code:
      court_list._load_courts()["address_county"].unique()
---
id: case number
question: |
  What is the case number?
subquestion: |
  ${ collapse_template(case_number_help) }
fields:
  - Case number: case_number
    maxlength: 19
---
template: case_number_help
subject: |
  **Learn about case numbers**
content: |  
  The case number should be on your court papers. Look at the Complaint or Petition, or the Summons if you received one. It is usually in the top-right part of the first page.
  
  If you started the case, the court clerk should have given you the case number.
  
  In this example, the case number is **2022 EXAMPLE 123**.
  
  [FILE case_number_example.png, 100%, Summons form showing case number]
---
########################## FAMILY  ######################
id: your name
sets:
    - users[0].name.first
    - users[0].name.last
    - users[0].name.middle
    - users[0].name.suffix
question: |
  What is your name?
fields:
  - code: |
      users[0].name_fields()
---
id: hide contact 
question: |
  Are your address and phone number protected by court order because of domestic violence or abuse?
subquestion: |
  If your contact information does not appear on other court papers because you have a protective order, you do not have to list them on your *${form_name}*. 

  Click **No** to list your address and phone number on your *${form_name}*.
fields:
  - no label: hide_contact
    datatype: yesnoradio
---
id: users address
sets:
  - users[0].address.address
  - users[0].address.city
  - users[0].address.state
  - users[0].address.zip
question: |
  What is your address?
subquestion: |
  **This address will appear on your form.** If you do not want this, click **Back** to keep your address hidden.
fields:
  - Street address: users[0].address.address
    address autocomplete: True
  - Address line 2: users[0].address.unit
    required: False
  - City: users[0].address.city
  - State: users[0].address.state
    code: |
      states_list()
    default: IL      
  - ZIP code: users[0].address.zip
---
id: your contact information
question: |
  What is your contact information?
subquestion: |
  The court or other parties might need to contact you about this case.

  **This information will appear on your court forms.**
  
  If you do not want to list a phone number on your forms, leave it blank.

  If you have an email address, you must list it. Be sure to check your email daily, otherwise you may miss important court documents or information about your case.

  ${ collapse_template(contact_info_help) }  
fields:  
  - Phone number: users[0].phone_number
    datatype: al_international_phone
    required: False
  - label: |
      Do you have an email address?
    field: users[0].has_email_address
    datatype: yesnoradio
  - note: |
      This email address will appear on your court forms. Be sure to check 
      this email daily, otherwise you may miss important information about 
      your case.
    show if:
      variable: users[0].has_email_address
      is: True
  - Email address: users[0].email
    datatype: email
    show if: 
      variable: users[0].has_email_address
      is: True
---
template: contact_info_help
subject: |
  **What if I don't want to list my email address?**
content: |  
  If you do not want to enter your personal email address, you can create a new email account to get email about your case.
  
  To make a new email account try one of these email services:
  
  * [**Gmail**](https://accounts.google.com/SignUp)
  * [**Outlook**](https://outlook.live.com/owa/?nlp=1&signup=1)
  * [**Yahoo**](https://login.yahoo.com/account/create?.lang=en-US&.intl=us)
---
id: your employer
question: |
  Do you have an employer?
subquestion: |
  If you do not currently have an employer, select **No**.
fields:
  - no label: has_employer
    datatype: yesnoradio
---
sets:
  - employer.name.first
id: your employer info 
question: |
  Employer information
fields: 
  - code: |
      employer.name_fields(person_or_business='unsure')
  - Street address: employer.address.address
    address autocomplete: True
  - Address line 2: employer.address.unit
    required: False
  - City: employer.address.city
  - State: employer.address.state
    code: |
      states_list()
    default: IL
  - ZIP code: employer.address.zip
  - Phone number: employer.phone_number
    datatype: al_international_phone
    required: False
---
id: other parties name
sets:
    - other_parties[0].name.first
    - other_parties[0].name.last
    - other_parties[0].name.middle
    - other_parties[0].name.suffix
question: |
  What is the other parent's name?
fields:
  - code: |
      other_parties[0].name_fields()
---
id: other parties address
question: |
  Is ${other_parties[0].name.full(middle="full")}'s address listed on other court forms in this case?
fields:
  - no label: has_other_address
    datatype: yesnoradio
---
id: other_parties address
sets:
  - other_parties[0].address.address
  - other_parties[0].address.city
  - other_parties[0].address.state
  - other_parties[0].address.zip
question: |
  What is ${other_parties[0].name.full(middle="full")}'s address?
fields:
  - Street address: other_parties[0].address.address
    address autocomplete: True
  - Address line 2: other_parties[0].address.unit
    required: False
  - City: other_parties[0].address.city
  - State: other_parties[0].address.state
    code: |
      states_list()
    default: IL      
  - ZIP code: other_parties[0].address.zip
---
id: your contact information
question: |
  What is ${other_parties[0].name.full(middle="full")}'s contact information?
fields:  
  - Phone number: other_parties[0].phone_number
    datatype: al_international_phone
    required: False
  - Email address: other_parties[0].email    
    datatype: email
    required: False
---
id: other parties employment
question: |
  Is ${other_parties[0].name.full(middle="full")}'s employed?
fields:
  - no label: has_other_employer
    datatype: yesnoradio
---
sets:
  - other_employer.name.first
id: other parties employer info 
question: |
  Employer information for ${other_parties[0].name.full(middle="full")}
fields: 
  - code: |
      other_employer.name_fields(person_or_business='unsure')
  - Street address: other_employer.address.address
    address autocomplete: True
  - Address line 2: other_employer.address.unit
    required: False
  - City: other_employer.address.city
  - State: other_employer.address.state
    code: |
      states_list()
    default: IL
  - ZIP code: other_employer.address.zip
  - Phone number: other_employer.phone_number
    datatype: al_international_phone
    required: False
---
code: |
  children[i].name.text
  children.complete = True
---
#### might remove this they must have at least one child to use this program
id: children
question: |
  Are there any children? 
fields:
  - no label: children.there_are_any
    datatype: yesnoradio
---
id: add children
sets:
  - children[i].name.first
  - children[i].name.last
question: |
  What is the ${ordinal(i)} child's name?
fields:
  - code: |
      children[i].name_fields()    
  - Age: children[i].age
    datatype: integer
    min: 0
    max: 18
validation code: |
  if showifdef("children[i].birthdate") and children[i].age > 18:
    validation_error("Child must be under 18")
---
id: any other children
question: |
  Do you have another child with ${other_parties[0].name.full(middle="full")}?
subquestion: |
  So far you have told us about ${comma_and_list(children.complete_elements().full_names())}.
fields:
  - "Anyone else?": children.there_is_another
    datatype: yesnoradio
---
########################## DECISIONS ######################
id: education decisions
question: |
  Who will make education decisions for the children?
subquestion: |
  Education decisions (includes choice of schools and tutors).
fields:
  - Decisions will be made by: eduction_decisions
    datatype: radio
    choices:
      - ${users[0].name.full(middle="full")}: petitioner
      - ${other_parties[0].name.full(middle="full")}: respondent
      - Both parents: both
---
id: healthcare decisions
question: |
  Who will make health care decisions for the children?
subquestion: |
  Health decisions (includes medical, dental, and psychological decisions).
fields:
  - Decisions will be made by: health_decisions
    datatype: radio
    choices:
      - ${users[0].name.full(middle="full")}: petitioner
      - ${other_parties[0].name.full(middle="full")}: respondent
      - Both parents: both
---
id: religious decisions
question: |
  Who will make religious decisions for the children?
fields:
  - Decisions will be made by: religious_decisions
    datatype: radio
    choices:
      - ${users[0].name.full(middle="full")}: petitioner
      - ${other_parties[0].name.full(middle="full")}: respondent
      - Both parents: both
---
id: activities decisions
question: |
  Who will make activities decisions for the children?
subquestion: |
  These include extracurricular and recreational decisions.
fields:
  - Decisions will be made by: activities_decisions
    datatype: radio
    choices:
      - ${users[0].name.full(middle="full")}: petitioner
      - ${other_parties[0].name.full(middle="full")}: respondent
      - Both parents: both
---
id: refuse childcare
question: |
  Right of first refusal for childcare
subquestion: |
  Decide whether a parent will notify the other parent of childcare needs and allow
  them the first opportunity to provide care. Is there a right of first refusal for childcare? 

  If **yes**, each parent must offer the other a first right of refusal as follows. 

  * If a parent needs childcare for a period of 24 hours or more during their time with
  the children, they must give the other parent the option to care for the children
  before finding other childcare. 

  * As soon as the need for childcare is known, the parent in need of childcare will 
  contact the other parent. 

  * The parent offered the right to care for the children must accept the offer within
  2 hours. If they do not, the parent needing childcare may use another caregiver. 

  * Transportation of the children is the same as for other parenting time.
fields:
  - no label: first_refusal
    datatype: yesnoradio
---
id: communications
question: |
  When can children communicate with the parent they are not with?
subquestion: |
  Electronic communication between the children and the other parent must not be 
  unreasonably monitored or interrupted. Electronic communication includes telephone,
  e-mail, text, video, etc.  
  
  Select one option for when the children will communicate with the parent they are not with. 
fields: 
  - no label: communication
    datatype: radio
    choices:
      - Anytime: anytime
      - Every day: daily 
      - Other: other
  - Every day between: daily_start
    datatype: time
    show if: 
      variable: communication
      is: daily
  - Concluding by: daily_end
    datatype: time
    show if: 
      variable: communication
      is: daily
  - Describe the other arrangement: other_description
    datatype: area
    show if: 
      variable: communication
      is: other
---
id: primary custody
question: |
  Which parent will have the most parenting time with the children?
subquestion: |
  Who has the most parenting time with the children? This designation will not 
  affect parents' rights and responsibilities under the *${form_name}*.
fields:
  - no label: primary_parent
    datatype: radio
    choices:
      - ${users[0].name.full(middle="full")}: petitioner
      - ${other_parties[0].name.full(middle="full")}: respondent
---
id: residential address
question: |
  Whose home is the children's residential address?
subquestion: |
  This is primarily for school enrollment purposes only.
fields:
  - no label: residential_address
    datatype: radio
    choices:
      - ${users[0].name.full(middle="full")}: petitioner
      - ${other_parties[0].name.full(middle="full")}: respondent
---
id: handling conflicts
question: |
  Handling conflicts
subquestion: |
  If a parent wishes to change this Parenting Plan or feels the other parent is not 
  following this Parenting Plan, the parents will talk and try to come to an agreement
  on their own.  

  If an agreement cannot be reached, parents will seek help from a mediator: 
fields:
  - Mediation is required on all issues because parents have joint decision making: mediation
    datatype: yesnowide
  - note: | 
      Parents must first try to come to an agreement through mediation. 
      
      * Both parents must cooperate in scheduling and participating in mediation 

      * Both parents must split the cost of mediation equally unless otherwise 
      ordered by the court
        
      If mediation is unsuccessful, a parent must file a petition to modify this 
      Parenting Plan or a petition to enforce this Parenting Plan with the court.  
      Emergencies: In an emergency situation, a parent may file a petition with the court
      to get an immediate resolution without first going through mediation. 
    show if: mediation
  - Mediation is not required on all issues because: no_mediation
    datatype: yesnowide
  - Reason for not requiring mediation: mediation_reason
    datatype: checkboxes
    none of the above: False
    choices:
      - One parent has all significant decision-making responsibility.: parent
      - There is a history of domestic violence between the parties.: history
      - Other reason: other
    show if: no_mediation
  - What are the other reasons?: other_reasons
    datatype: area
    show if: 
      variable: mediation_reason['other']
      is: True
  - note: |
      A parent must file a petition to change this *${form_name}* or a petition to 
      enforce this *${form_name}* with the court
    show if: no_mediation
---




---
########################## PARENTING TIME ######################
id: parenting time
question: |
  Weekly parenting time
subquestion: |
  The *Parenting Plan* will include a parenting time schedule for when each parent 
  will have the children. The form breaks down the time on an hour-by-hour basis. 
  The forms allow for up to four different weekly schedules.

  **Note:** Parenting time schedules for holidays and school breaks can be entered 
  on other screens. The weekly schedule covers non-holidays and weeks when school 
  is in session.
fields:
  - Do you want to fill in the parenting time schedule now?: parenting_time
    datatype: radio
    choices:
      - Yes, I will enter the days and times for each parent on the next screens.: yes
      - No, I will decide weekly parenting time later. I will fill out the schedule by hand or attach one to the *Parenting Plan*.: no
---


---
########################## TERMS ######################
id: rights and responsibilities
question: |
  Rights and responsibilities of the parents
subquestion: |
  This is what each parent will do when the children are with them. 

  A. Make day-to-day decisions for the children when they have them, such as routine 
  discipline, minor medical treatment, curfew, chores, and hygiene.

  B. Give the other parent the name, address, and telephone number of any health 
  care provider for the children.

  C. Have access to the children's school records, childcare information, 
  extracurricular activity schedules, and medical, dental, and mental health records
  unless access is denied by the judge.

  D. Notify the other parent as soon as possible of emergencies, health care, travel
  plans, or other significant child-related issues
fields:
  - I have read and understand the above: accept
    datatype: checkboxes
    none of the above: False
    minlength: 1
    choices:
      - I have read and understand the above.
    validation messages:
      minlength: |
        You cannot continue unless you have read and understand the above information.
continue button field: accept_rights
---

---
###################### DOWNLOAD SECTION #########################
id: forms assembling
continue button field: forms_assembling
question: |
  Almost done
subquestion: |
  After you click **Next**, it may take a few moments to finish making your forms.
  
  ###### You do not need to refresh your screen. Hang in there!
  
  [NEWLINE]
---
id: get docs screen
event: get_docs_screen
question: |
  Download
subquestion: |
  Your form is ready. View and download your form below. Click **Make changes** to fix any mistakes.

  This program does not deliver your *${form_name}* to other party in your case. You will need to do that yourself.

  ${ action_button_html(url_action('review_answers'), label=':edit: Make changes', color='success', size="md") }

  ${ al_user_bundle.download_list_html() }

  [NEWLINE]

  ${ al_user_bundle.send_button_html(show_editable_checkbox=False) }


  **Note:** This program does not deliver your *${form_name}* to other party in your case. You will need to do that yourself.
  
  Thank you for using ILAO Easy Forms!
under: |
  % if not user_logged_in():
  [${fa_icon("sign-in-alt", color="#0079d0", size="sm")} **Sign-in**](${url_of('login', next=interview_url())}) or [**create**](${url_of('register', next=interview_url())}) an ILAO Easy Form account to save your progress (optional).
  % endif

  ${ action_button_html(interview_url(i="docassemble.ILAO:feedback.yml", easy_form_interview=ilao_easy_form_url, easy_form_title=ilao_easy_form_title, easy_form_page=user_info().question_id, easy_form_variable=user_info().variable, local=False,reset=1), label=':comment: Was this program helpful?', color="#181c36", size="md", new_window=True) }
---
#################### REVIEW SCREEN #########################
id: review screen
event: review_answers
skip undefined: False
question: |
  Review screen
subquestion: |
  Edit your answers below.
review: 
  - note: |
      <h4>Case info</h4>
  - Edit: plan_type
    button: |
      **Parenting Plan:**
      % if plan_type == "petitioner":
      Yours
      % elif plan_type == "respondent":
      The other parent's
      % elif plan_type == "both":
      An agreed Parenting Plan, Unsure
      % endif
  - Edit: case_county
    button: |
      **County where this case is filed:**
      ${ case_county }
  - Edit: case_number
    button: |
      **Case number:**
      ${ case_number }
  - note: |
      <h4>Family members</h4>
  - Edit: users[0].name.first
    button: |
      **Your name:**
      ${ users[0].name.full(middle="full") }
  - Edit: hide_contact
    button: |
      **Do you want to hide your address?**
      ${ word(yesno(hide_contact))}  
  - Edit: users[0].address.address
    button: |
      **Your address:**
      ${ users[0].address.on_one_line(bare=True) }
    show if: hide_contact == False
  - Edit: users[0].phone_number
    button: |
      **Your phone number:**
      % if users[0].phone_number == "":
      None entered
      % else:
      ${ phone_number_formatted(users[0].phone_number) }
      % endif

      **Your email address:**
      % if users[0].has_email_address:
      No email address
      % else:
      ${ users[0].email }
      % endif
  - Edit: has_employer
    button: |
      **Do you have income from employment?**
      ${word(yesno(has_employer))}
  - Edit: employer.name.first
    button: |
      **Employer name:**
      ${ employer.name.full(middle="full") }
      
      **Employer address:**
      ${ employer.address.on_one_line(bare=True) }
      
      **Employer phone:**
      ${ phone_number_formatted(employer.phone_number) }
    show if: has_employer
  - Edit: other_parties[0].name.first
    button: |
      **Other parent's name:**
      ${ other_parties[0].name.full(middle="full") }}
  - Edit: has_other_address
    button: |
      **Have other parent's address:**
      ${ word(yesno(has_other_address))}  
  - Edit: other_parties[0].address.address
    button: |
      **Other parent's address:**
      ${ other_parties[0].address.on_one_line(bare=True) }
    show if: has_other_address
  - Edit: other_parties[0].phone_number
    button: |
      **Other parent's phone number:**
      % if other_parties[0].phone_number == "":
      None entered
      % else:
      ${ phone_number_formatted(other_parties[0].phone_number) }
      % endif

      **Other parent's email address:**
      % if other_parties[0].email == "":
      No email address
      % else:
      ${ other_parties[0].email }
      % endif
  - Edit: has_other_employer
    button: |
      **Other parent's employment?**
      ${word(yesno(has_other_employer))}
  - Edit: other_employer.name.first
    button: |
      **Employer name:**
      ${ other_employer.name.full(middle="full") }
      
      **Employer address:**
      ${ other_employer.address.on_one_line(bare=True) }
      
      **Employer phone:**
      ${ phone_number_formatted(other_employer.phone_number) }
    show if: has_other_employer
  - Edit: children.revisit
    button: |
      **Children and age**

      % for child in children:
        * ${ child.name.full() }, ${ child.age }
      % endfor
  - note: |
      <h4>Decisions</h4>
  - Edit: eduction_decisions
    button: |
      **Education decisions made by:**
      % if eduction_decisions == "petitioner":
      ${ users[0].name.full(middle="full") }}
      % elif eduction_decisions == "respondent":
      ${ other_parties[0].name.full(middle="full") }}
      % elif eduction_decisions == "both":
      Both parents
      % endif
  - Edit: health_decisions
    button: |
      **Healthcare decisions made by:**
      % if health_decisions == "petitioner":
      ${ users[0].name.full(middle="full") }}
      % elif health_decisions == "respondent":
      ${ other_parties[0].name.full(middle="full") }}
      % elif health_decisions == "both":
      Both parents
      % endif
  - Edit: religious_decisions
    button: |
      **Religious decisions made by:**
      % if religious_decisions == "petitioner":
      ${ users[0].name.full(middle="full") }}
      % elif religious_decisions == "respondent":
      ${ other_parties[0].name.full(middle="full") }}
      % elif religious_decisions == "both":
      Both parents
      % endif
  - Edit: activities_decisions
    button: |
      **Activity decisions made by:**
      % if activities_decisions == "petitioner":
      ${ users[0].name.full(middle="full") }}
      % elif activities_decisions == "respondent":
      ${ other_parties[0].name.full(middle="full") }}
      % elif activities_decisions == "both":
      Both parents
      % endif
  - Edit: first_refusal
    button: |
      **Right of first refusal for childcare?**
      ${word(yesno(first_refusal))}
  - Edit: communication
    button: |
      **Children communicate with other parent?**
      % if communication == "anytime":
      Anytime
      % elif communication == "daily":
      Daily

      **Start**:
      ${ format_time(daily_start, 'hh:mm a') }

      **End**:
      ${ format_time(daily_end, 'hh:mm a') }
      % elif communication == "other":
      Other: 
      ${ other_description }
      % endif
  - Edit: primary_parent
    button: |
      **Primary parent of the children:**
      % if primary_parent == "petitioner":
      ${ users[0].name.full(middle="full") }}
      % elif primary_parent == "respondent":
      ${ other_parties[0].name.full(middle="full") }}
      % endif
  - Edit: residential_address
    button: |
      **Children's residential address?:**
      % if residential_address == "petitioner":
      ${ users[0].name.full(middle="full") }}
      % elif residential_address == "respondent":
      ${ other_parties[0].name.full(middle="full") }}
      % endif
  - Edit: mediation
    button: |
      **Mediation is required on all issues:**
      ${word(yesno(mediation))}

      **Mediation is not required on all issues:**
      ${word(yesno(no_mediation))}

      % if no_mediation:
        % if mediation_reason['parent']:
        * One parent has all significant decision-making responsibility.
        % endif

        % if mediation_reason['history']:
        * There is a history of domestic violence between the parties.
        % endif

        % if mediation_reason['history']:
        * Other reason: ${ other_reasons } 
        % endif
      % endif

---
################ REVISIT TABLES ###################
id: children table
table: children.table
rows: children
columns:
  - Child name: |
      row_item.name.full()
  - Age: |
      row_item.age
  - Edit to change details: |
      action_button_html(url_action(row_item.attr_name("name.first")), label="Edit", icon="pencil-alt")
delete buttons: True
confirm: True
---
id: children review screen
continue button field: children.revisit
question: |
  Edit information about your children and business income
subquestion: |
  ${ children.table }

  ${ children.add_action() }
---
objects:
  - al_user_bundle: ALDocumentBundle.using(elements=[instructions, parenting_plan_bundle], filename="completed_parenting_plan.pdf", title="All forms", enabled=True)
---
objects:
  - parenting_plan_bundle: ALDocumentBundle.using(title="Parenting Plan", filename="parenting_plan.pdf", enabled=True, elements=[
        parenting_plan,
        additional_parenting_time,
        additional_children,
      ])
---
objects:
  - instructions: ALDocument.using(title="Instructions", filename="instructions.pdf", enabled=True, has_addendum=False)
  - parenting_plan: ALDocument.using(title="Parenting Plan", filename="parenting_plan.pdf", enabled=True, has_addendum=False)
---
attachment:
  - name: instructions
    variable name: instructions[i]
    filename: instructions
    pdf template file: instructions.pdf
---
attachment:
  - name: parenting_plan
    variable name: parenting_plan[i]
    filename: parenting_plan
    pdf template file: parenting_plan.pdf
    skip undefined: True
    editable: False
    fields:
      - "plan_petitioner": ${ plan_type == 'petitioner' }
      - "plan_respondent": ${ plan_type == 'respondent' }
      - "plan_agreed": ${ plan_type == 'both' }
      #- "plan_court": ${ plan_type == 'court' }
      - "county_name": ${ case_county }
      - "case_number": ${ case_number }
      - "petitioner_name": ${ users[0].name.full(middle="full") }
      - "respondent_name": ${ other_parties[0].name.full(middle="full") }
      - "petitioner_address": |
          % if not hide_contact:
          ${ users[0].address.on_one_line(bare=True) }
          % endif
      - "petitioner_phone": ${ phone_number_formatted(users[0].phone_number) }
      - "petitioner_email": |
          % if users[0].has_email_address:
          ${ users[0].email }
          % endif
      - "petitioner_employed_yes": ${ has_employer }
      - "petitioner_employed_no": ${ not has_employer }
      - "petitioner_employer_name": |
          % if has_employer:
          ${ employer.name.full(middle="full") }
          % endif
      - "petitioner_employer_address": |
          % if has_employer:
          ${ employer.address.on_one_line(bare=True) }
          % endif
      - "petitioner_employer_phone": |
          % if has_employer:
          ${ phone_number_formatted(employer.phone_number) }
          % endif
      - "respondent_address": |
          % if has_other_address:
          ${ other_parties[0].address.on_one_line(bare=True) }
          % endif
      - "respondent_phone": ${ phone_number_formatted(other_parties[0].phone_number) }
      - "respondent_email": ${ other_parties[0].email }
      - "respondent_employed_yes": ${ has_other_employer }
      - "respondent_employed_no": ${ not has_other_employer }
      - "respondent_employer_name": |
          % if has_other_employer:
          ${ other_employer.name.full(middle="full") }
          % endif
      - "respondent_employer_address": |
          % if has_other_employer:
          ${ other_employer.address.on_one_line(bare=True) }
          % endif
      - "respondent_employer_phone": |
          % if has_other_employer:
          ${ phone_number_formatted(other_employer.phone_number) }
          % endif
      - "child_name1": ${ children[0].name.full() }
      - "child_age1": ${ children[0].age }
      - "child_name2": |
          % if children.number_gathered() >= 2:
          ${ children[1].name.full() }
          % endif
      - "child_age2": |
          % if children.number_gathered() >= 2:
          ${ children[1].age }
          % endif
      - "child_name3": |
          % if children.number_gathered() >= 3:
          ${ children[2].name.full() }
          % endif
      - "child_age3": |
          % if children.number_gathered() >= 3:
          ${ children[2].age }
          % endif
      - "additional_children_yes": ${ children.number_gathered() > 3 }
      # 6. SIGNIFICANT DECISION MAKING
      - "6A_petitioner_only": ${ eduction_decisions == "petitioner" }
      - "6A_respondent_only": ${ eduction_decisions == "respondent" }
      - "6A_both_parents": ${ eduction_decisions == "both" }
      - "6B_petitioner_only": ${ health_decisions == "petitioner" }
      - "6B_respondent_only": ${ health_decisions == "respondent" }
      - "6B_both_parents": ${ health_decisions == "both" }
      - "6C_petitioner_only": ${ religious_decisions == "petitioner" }
      - "6C_respondent_only": ${ religious_decisions == "respondent" }
      - "6C_both_parents": ${ religious_decisions == "both" }
      - "6D_petitioner_only": ${ activities_decisions == "petitioner" }
      - "6D_respondent_only": ${ activities_decisions == "respondent" }
      - "6D_both_parents": ${ activities_decisions == "both" }
      # 10. FIRST REFUSAL FOR CHILDCARE 
      - "refusal_no": ${ first_refusal }
      - "refusal_yes": ${ not first_refusal }
      # 11. COMMUNICATION 
      - "anytime": ${ communication == "anytime" }
      - "daily": ${ communication == "daily" }
      - "start_time": ${ format_time(daily_start, 'h:mm') }
      - "start_am": ${ format_time(daily_start, 'a') == 'AM' }
      - "start_pm": ${ format_time(daily_start, 'a') == 'PM' }
      - "end_time": ${ format_time(daily_end, 'h:mm') }
      - "end_am": ${ format_time(daily_end, 'a') == 'AM' }
      - "end_pm": ${ format_time(daily_end, 'a') == 'PM' }
      - "other": ${ communication == "other" }
      - "other_description": |
          % if communication == "other":
          ${ other_description }
          % endif
      # 13. CUSTODY & RESIDENCE FOR OTHER PURPOSES
      - "13A_petitioner": ${ primary_parent == "petitioner" }
      - "13A_respondent": ${ primary_parent == "respondent" }
      - "13B_petitioner": ${ residential_address == "petitioner" }
      - "13B_respondent": ${ residential_address == "respondent" }

      # 15. HANDLING CONFLICTS (MEDIATION)
      - "mediatiion_yes": ${ mediation } 
      - "mediation_no": ${ no_mediation } 
      - "parent": |
          % if no_mediation:
          ${ mediation_reason['parent'] } 
          % endif
      - "history": |
          % if no_mediation:
          ${ mediation_reason['history'] } 
          % endif
      - "other_reason": |
          % if no_mediation:
          ${ mediation_reason['other'] } 
          % endif
      - "other_reason_area": |
          % if no_mediation:
            % if mediation_reason['other']:
            ${ other_reasons } 
            % endif
          % endif

      # WEEK 1-2 SCHEDULE

      # Remaining
      # - "no_spring_break": No
      # - "spring_break_split": No
      # - "spring_break_even": something
      # - "spring_break_odd": something
      # - "spring_break_other": No
      # - "spring_break_other_details": something
      # - "spring_break_other_end": something
      # - "spring_break_other_start": something
      # - "no_summer_break": No
      # - "summer_break_split": No
      # - "summer_break_odd": something
      # - "summer_break_even": something
      # - "summer_break_other": No
      # - "summer_break_other_details": something
      # - "summer_break_other_end": something
      # - "summer_break_other_start": something
      # - "no_winter_break": No
      # - "winter_break_even": something
      # - "winter_break_split": No
      # - "winter_break_odd": something
      # - "winter_break_other": No
      # - "winter_break_other_details": something
      # - "winter_break_other_end": something
      # - "winter_break_other_start": something
      # - "additional_parenting_time": No
      # - "transportation_petitioner": No
      # - "transportation_respondent": No
      # - "transportation_start": No
      # - "transportation_end": No
      # - "transportation_other": No
      # - "transportation_other_details": something
      # - "exchange_home": No
      # - "location": something
      # - "exchange_location": No
      # - "location_address": something


      
---
objects:
  - additional_parenting_time: ALDocument.using(title="Additional Parenting Time", filename="additional_parenting_time.pdf", has_addendum=False)
---
code: |
  additional_parenting_time.enabled = False
---
attachment:
  - name: additional_parenting_time
    variable name: additional_parenting_time[i]
    filename: additional_parenting_time
    pdf template file: additional_parenting_time.pdf
---
objects:
  - additional_children: ALDocument.using(title="Additional children", filename="additional_children.pdf", has_addendum=False)
---
code: |
  additional_children.enabled = children.number_gathered() > 3
---
attachment:
  - name: additional_children
    variable name: additional_children[i]
    filename: additional_children
    pdf template file: additional_children.pdf
    skip undefined: True
    editable: False
    fields:
      - "county_name": ${ case_county }
      - "case_number": ${ case_number }
      - "petitioner_name": ${ users[0].name.full(middle="full") }
      - "respondent_name": ${ other_parties[0].name.full(middle="full") }
      - "child_name4": |
          % if children.number_gathered() >= 4:
          ${ children[3].name.full() }
          % endif
      - "child_age4": |
          % if children.number_gathered() >= 4:
          ${ children[3].age }
          % endif
      - "child_name5": |
          % if children.number_gathered() >= 5:
          ${ children[4].name.full() }
          % endif
      - "child_age5": |
          % if children.number_gathered() >= 5:
          ${ children[4].age }
          % endif
      - "child_name6": |
          % if children.number_gathered() >= 6:
          ${ children[5].name.full() }
          % endif
      - "child_age6": |
          % if children.number_gathered() >= 6:
          ${ children[5].age }
          % endif
      - "child_name7": |
          % if children.number_gathered() >= 7:
          ${ children[6].name.full() }
          % endif
      - "child_age7": |
          % if children.number_gathered() >= 7:
          ${ children[6].age }
          % endif
      - "child_name8": |
          % if children.number_gathered() >= 8:
          ${ children[7].name.full() }
          % endif
      - "child_age8": |
          % if children.number_gathered() >= 8:
          ${ children[7].age }
          % endif
      - "child_name9": |
          % if children.number_gathered() >= 9:
          ${ children[8].name.full() }
          % endif
      - "child_age9": |
          % if children.number_gathered() >= 9:
          ${ children[8].age }
          % endif
      - "child_name10": |
          % if children.number_gathered() >= 10:
          ${ children[9].name.full() }
          % endif
      - "child_age10": |
          % if children.number_gathered() >= 10:
          ${ children[9].age }
          % endif
---